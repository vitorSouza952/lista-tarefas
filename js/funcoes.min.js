const formAdicionar=document.querySelector("#form-adicionar");const campoTarefa=document.querySelector("#campo-tarefa");const formFiltrar=document.querySelector("#form-filtrar");const campoCategoria=document.querySelector("#campo-categoria");const conteudoPrincipal=document.querySelector("#conteudo-principal");const listaTarefas=document.querySelector("#lista-tarefas");const template=document.querySelector("#template");const fundoModalEditar=document.querySelector("#fundo-modal-editar");const modalEditar=document.querySelector("#modal-editar");const formEditar=document.querySelector("#form-editar");const campoNovaTarefa=document.querySelector("#campo-nova-tarefa");const botaoCancelar=document.querySelector("#botao-cancelar");const fundoModalMsg=document.querySelector("#fundo-modal-msg");const modalMsg=document.querySelector("#modal-msg");const txtModalMsg=document.querySelector("#txt-modal-msg");const botaoFecharModalMsg=document.querySelector("#botao-fechar-modal-msg");let tarefas=JSON.parse(localStorage.getItem("tarefas"))||[];let iTarefaEditar;const resgatarTarefas=async()=>{if(!existemTarefas()){try{const resposta=await fetch("json/tarefas-iniciais.json");if(!resposta.ok)
throw new Error("Não foi possível resgatar as tarefas iniciais.");tarefas=await resposta.json();salvarTarefas()}catch(err){alternarMsg(err)}}
carregarTarefas(tarefas)};const existemTarefas=()=>tarefas.length>0;const salvarTarefas=()=>localStorage.setItem("tarefas",JSON.stringify(tarefas));const alternarMsg=(msg)=>{alternarModal(fundoModalMsg,modalMsg);txtModalMsg.textContent=msg};const alternarModal=(fundoModal,modal)=>[fundoModal,modal].forEach((el)=>el.classList.toggle("esconder"));const carregarTarefas=(tarefas)=>{const scrollY=window.scrollY;listaTarefas.replaceChildren();tarefas.forEach((el)=>{const cloneTemplate=template.content.cloneNode(!0);const itemTarefa=cloneTemplate.querySelector(".item-tarefa");const txtTarefa=itemTarefa.querySelector(".txt-tarefa");const botaoAlternarEstado=itemTarefa.querySelector(".botao-alternar-estado");const botaoEditar=itemTarefa.querySelector(".botao-editar");const botaoRemover=itemTarefa.querySelector(".botao-remover");if(el.concluida){const txtBotaoConcluida=document.createTextNode("Tornar Pendente ");const iconeTornarTarefaPendente=document.createElement("i");itemTarefa.classList.add("concluida");iconeTornarTarefaPendente.classList.add("bi");iconeTornarTarefaPendente.classList.add("bi-x-square");botaoAlternarEstado.replaceChildren(txtBotaoConcluida,iconeTornarTarefaPendente)}
txtTarefa.textContent=el.txt;botaoAlternarEstado.addEventListener("click",()=>alternarEstadoTarefa(el));botaoEditar.addEventListener("click",()=>prepararEdicaoTarefa(el));botaoRemover.addEventListener("click",()=>removerTarefa(el));listaTarefas.appendChild(itemTarefa);if(conteudoPrincipal.classList.contains("esconder"))
alternarConteudoPrincipal(!0);});window.scrollTo(0,scrollY)};const alternarEstadoTarefa=(tarefa)=>{const i=tarefas.indexOf(tarefa);if(i!==-1){tarefas[i].concluida=!tarefas[i].concluida;salvarTarefas();carregarTarefas(tarefas)}};const prepararEdicaoTarefa=(tarefa)=>{const i=tarefas.indexOf(tarefa);if(i!==-1){campoNovaTarefa.value=tarefa.txt;iTarefaEditar=i;alternarModal(fundoModalEditar,modalEditar)}};const removerTarefa=(tarefa)=>{const i=tarefas.indexOf(tarefa);if(i!==-1){tarefas.splice(i,1);if(tarefas.length===0){removerTarefasArmazLocal();alternarConteudoPrincipal(!1)}else{salvarTarefas();carregarTarefas(tarefas)}
alternarMsg("Tarefa deletada com sucesso!")}};const removerTarefasArmazLocal=()=>localStorage.removeItem("tarefas");const alternarConteudoPrincipal=(exibir)=>{if(exibir)conteudoPrincipal.classList.remove("esconder");else conteudoPrincipal.classList.add("esconder")};const validarTarefa=(tarefa)=>tarefa!==""&&tarefa.length<=30;const adicionarTarefa=(tarefa)=>{if(existeTarefa(tarefa)){alternarMsg("Erro: Tarefa já existente. Por favor, tente novamente.")}else{tarefas.push({txt:tarefa,concluida:!1});salvarTarefas();carregarTarefas(tarefas);alternarMsg("Tarefa adicionada com sucesso!")}};const existeTarefa=(tarefa)=>tarefas.some((el)=>el.txt.trim().toLowerCase()===tarefa.toLowerCase());const filtrarTarefas=(estado)=>{const tarefasFiltradas=tarefas.filter((el)=>el.concluida===estado);if(tarefasFiltradas.length>0)carregarTarefas(tarefasFiltradas);else alternarMsg("Erro: Não existem tarefas nesta categoria. Por favor, tente novamente.")};const editarTarefa=(novaTarefa)=>{if(existeTarefa(novaTarefa)){alternarMsg("Erro: Tarefa já existente. Por favor, tente novamente.")}else{tarefas[iTarefaEditar].txt=novaTarefa;salvarTarefas();if(tarefas[iTarefaEditar].concluida)alternarEstadoTarefa(iTarefaEditar);carregarTarefas(tarefas);alternarMsg("Tarefa editada com sucesso!")}};const limparCampoNovaTarefa=()=>(campoNovaTarefa.value="");window.addEventListener("load",()=>resgatarTarefas());formAdicionar.addEventListener("submit",(e)=>{e.preventDefault();const tarefa=campoTarefa.value.trim();if(!validarTarefa(tarefa))
alternarMsg("Erro: A tarefa é obrigatória e deve conter até 30 caracteres. Por favor, tente novamente.");else adicionarTarefa(tarefa);campoTarefa.value="";if(window.innerWidth>=992)campoTarefa.focus();else campoTarefa.blur()});formFiltrar.addEventListener("submit",(e)=>{e.preventDefault();const categoria=campoCategoria.value.trim();if(existemTarefas()){switch(categoria){case "0":carregarTarefas(tarefas);break;case "1":filtrarTarefas(!1);break;case "2":filtrarTarefas(!0);break;default:carregarTarefas(tarefas);alternarMsg("Erro: Por favor, selecione uma categoria.")}}else{alternarMsg("Erro: Não existem tarefas adicionadas. Por favor, adicione uma.")}
campoCategoria.value=""});formEditar.addEventListener("submit",(e)=>{e.preventDefault();const novaTarefa=campoNovaTarefa.value.trim();if(!validarTarefa(novaTarefa))
alternarMsg("Erro: A nova tarefa é obrigatória e deve conter até 30 caracteres. Por favor, tente novamente.");else editarTarefa(novaTarefa);alternarModal(fundoModalEditar,modalEditar);limparCampoNovaTarefa()});[fundoModalEditar,botaoCancelar].forEach((el)=>el.addEventListener("click",()=>{alternarModal(fundoModalEditar,modalEditar);limparCampoNovaTarefa();alternarMsg("Edição de tarefa cancelada!")}));[fundoModalMsg,botaoFecharModalMsg].forEach((el)=>el.addEventListener("click",()=>alternarMsg("")))